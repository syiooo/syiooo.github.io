
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://www.sy-study.top/3_408/CSAPP/%E7%AC%AC%E4%BA%8C%E7%AB%A0%20%E4%BF%A1%E6%81%AF%E7%9A%84%E8%A1%A8%E7%A4%BA%E5%92%8C%E5%A4%84%E7%90%86/2.3%20%E6%95%B4%E6%95%B0%E8%BF%90%E7%AE%97/">
      
      
        <link rel="prev" href="../2.2%20%E6%95%B4%E6%95%B0%E8%A1%A8%E7%A4%BA/">
      
      
        <link rel="next" href="../2.4%20%E6%B5%AE%E7%82%B9%E6%95%B0/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>2.3 整数运算 - Sy_Blog&Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#23" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Sy_Blog&amp;Notes" class="md-header__button md-logo" aria-label="Sy_Blog&Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sy_Blog&Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2.3 整数运算
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../1_Math/Latex%20Suite%20%E5%A4%87%E5%BF%98%E6%B8%85%E5%8D%95%F0%9F%A7%BE/" class="md-tabs__link">
          
  
  
    
  
  1 Math

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../2_English/%E5%A4%96%E5%88%8A/%E3%80%90Guardian%E3%80%91Israel-strikes-Syria%E2%80%99s-defence-ministry-in-third-day-of-attacks/" class="md-tabs__link">
          
  
  
    
  
  2 English

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  3 408

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../4_Experience/" class="md-tabs__link">
          
  
  
    
  
  4 Experience

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../5_Cognition/%E3%80%90%E4%B8%93%E6%B3%A8%E5%8A%9B%E3%80%91%E4%B8%93%E6%B3%A8%E5%8A%9B%E6%8F%90%E5%8D%87/" class="md-tabs__link">
          
  
  
    
  
  5 Cognition

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../6_DataStructure/%E3%80%90%E7%AC%AC%E4%B8%80%E7%AB%A0%E3%80%91%E7%BB%AA%E8%AE%BA/" class="md-tabs__link">
          
  
  
    
  
  6 DataStructure

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../blog/" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Sy_Blog&amp;Notes" class="md-nav__button md-logo" aria-label="Sy_Blog&Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Sy_Blog&Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
  
  <span class="md-ellipsis">
    首页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../../1_Math/Latex%20Suite%20%E5%A4%87%E5%BF%98%E6%B8%85%E5%8D%95%F0%9F%A7%BE/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    1 Math
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../../../2_English/%E5%A4%96%E5%88%8A/%E3%80%90Guardian%E3%80%91Israel-strikes-Syria%E2%80%99s-defence-ministry-in-third-day-of-attacks/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    2 English
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    3 408
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            3 408
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    CSAPP
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            CSAPP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    第一章 计算机系统漫游
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    第二章 信息的表示和处理
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_3" id="__nav_4_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            第二章 信息的表示和处理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.1%20%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.1 信息存储
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.2%20%E6%95%B4%E6%95%B0%E8%A1%A8%E7%A4%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.2 整数表示
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    2.3 整数运算
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    2.3 整数运算
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#231" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.1 无符号加法
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#232" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.2 补码加法
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#233" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.3 补码的非
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#234" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.4 无符号乘法
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#235" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.5 补码乘法
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#236" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.6 乘以常数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#237-2" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.7 除以 2 的幂
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.4%20%E6%B5%AE%E7%82%B9%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.4 浮点数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.5%20%E5%B0%8F%E7%BB%93/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.5 小结
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E8%AF%B4%E6%98%8E/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    参考文献说明
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%AE%B6%E5%BA%AD%E4%BD%9C%E4%B8%9A/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    家庭作业
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BB%83%E4%B9%A0%E9%A2%98%E7%AD%94%E6%A1%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    练习题答案
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../%E6%96%B9%E6%B3%95%E8%AE%BA/%E3%80%90408%E6%95%99%E6%9D%90%E6%8E%A8%E8%8D%90%E3%80%91%E4%BB%8E%E7%8E%8B%E9%81%93%E5%88%B0%E9%BB%91%E4%B9%A6%EF%BC%8C%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    方法论
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../../4_Experience/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    4 Experience
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../../5_Cognition/%E3%80%90%E4%B8%93%E6%B3%A8%E5%8A%9B%E3%80%91%E4%B8%93%E6%B3%A8%E5%8A%9B%E6%8F%90%E5%8D%87/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    5 Cognition
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../../6_DataStructure/%E3%80%90%E7%AC%AC%E4%B8%80%E7%AB%A0%E3%80%91%E7%BB%AA%E8%AE%BA/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    6 DataStructure
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../../blog/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#231" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.1 无符号加法
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#232" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.2 补码加法
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#233" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.3 补码的非
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#234" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.4 无符号乘法
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#235" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.5 补码乘法
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#236" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.6 乘以常数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#237-2" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.7 除以 2 的幂
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="23">2.3 整数运算<a class="headerlink" href="#23" title="Permanent link">&para;</a></h1>
<p>许多刚入门的程序员非常惊奇地发现, 两个正数相加会得出一个负数, 而比较表达式 <span class="arithmatex">\(\mathrm{x} &lt; \mathrm{y}\)</span> 和比较表达式 <span class="arithmatex">\(\mathrm{x} - \mathrm{y} &lt; 0\)</span> 会产生不同的结果。这些属性是由于计算机运算的有限性造成的。理解计算机运算的细微之处能够帮助程序员编写更可靠的代码。</p>
<h2 id="231">2.3.1 无符号加法<a class="headerlink" href="#231" title="Permanent link">&para;</a></h2>
<p>考虑两个非负整数 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> ,满足 <span class="arithmatex">\(0 \leq  x,y &lt; {2}^{w}\)</span> 。每个数都能表示为 <span class="arithmatex">\(w\)</span> 位无符号数字。然而, 如果计算它们的和,我们就有一个可能的范围 <span class="arithmatex">\(0 \leq  x + y \leq  {2}^{w + 1} - 2\)</span> 。表示这个和可能需要 <span class="arithmatex">\(w + 1\)</span> 位。例如,图 2-21 展示了当 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 有 4 位表示时,函数 <span class="arithmatex">\(x + y\)</span> 的坐标图。参数 (显示在水平轴上) 取值范围为 0~15,但是和的取值范围为 0~30。函数的形状是一个有坡度的平面 (在两个维度上,函数都是线性的)。如果保持和为一个 <span class="arithmatex">\(w + 1\)</span> 位的数字,并且把它加上另外一个数值,我们可能需要 <span class="arithmatex">\(w + 2\)</span> 个位,以此类推。这种持续的 “字长膨胀” 意味着,要想完整地表示算术运算的结果, 我们不能对字长做任何限制。一些编程语言, 例如 Lisp, 实际上就支持无限精度的运算, 允许任意的 (当然, 要在机器的内存限制之内) 整数运算。更常见的是, 编程语言支持固定精度的运算, 因此像 “加法” 和 “乘法” 这样的运算不同于它们在整数上的相应运算。</p>
<!-- Media -->

<!-- figureText: 32 14 28 24 20 16 12 4 0 10 -->

<p><img src="https://cdn.noedgeai.com/bo_d2ft4sref24c73b0iki0_39.jpg?x=385&y=1446&w=892&h=703&r=0"/></p>
<p>图 2-21 整数加法。对于一个 4 位的字长, 其和可能需要 5 位</p>
<!-- Media -->

<!-- Meanless: 第 2 章 信息的表示和处理 61-->

<p>让我们为参数 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 定义运算 <span class="arithmatex">\(+ \frac{u}{w}\)</span> ,其中 <span class="arithmatex">\(0 \leq  x,y &lt; {2}^{w}\)</span> ,该操作是把整数和 <span class="arithmatex">\(x + y\)</span> 截断为 <span class="arithmatex">\(w\)</span> 位得到的结果,再把这个结果看做是一个无符号数。这可以被视为一种形式的模运算,对 <span class="arithmatex">\(x + y\)</span> 的位级表示,简单丢弃任何权重大于 <span class="arithmatex">\({2}^{w - 1}\)</span> 的位就可以计算出和模 <span class="arithmatex">\({2}^{w}\)</span> 。比如, 考虑一个 4 位数字表示, <span class="arithmatex">\(x = 9\)</span> 和 <span class="arithmatex">\(y = {12}\)</span> 的位表示分别为[1001]和[1100]。它们的和是 21, 5 位的表示为[10101]。但是如果丢弃最高位,我们就得到[0101],也就是说,十进制值的 5 。这就和值 <span class="arithmatex">\({21}{\;\operatorname{mod}\;{16}} = 5\)</span> 一致。</p>
<p>我们可以将操作 <span class="arithmatex">\({ + }_{w}^{\mathrm{u}}\)</span> 描述为:</p>
<p>原理：无符号数加法</p>
<p>对满足 <span class="arithmatex">\(0 \leq  x,y &lt; {2}^{w}\)</span> 的 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 有:</p>
<div class="arithmatex">\[
x + {}_{w}^{u}y = \left\{  \begin{array}{ll} x + y, &amp; x + y &lt; {2}^{w} \\  x + y - {2}^{w}, &amp; {2}^{w} \leq  x + y &lt; {2}^{w + 1} \end{array}\right. 
\]</div>
<p>正常(2.11)溢出</p>
<p>图 2-22 说明了公式 (2.11) 的这两种情况,左边的和 <span class="arithmatex">\(x +\)</span> <span class="arithmatex">\(y\)</span> 映射到右边的无符号 <span class="arithmatex">\(w\)</span> 位的和 <span class="arithmatex">\(x + {}_{w}^{u}y\)</span> 。正常情况下 <span class="arithmatex">\(x + y\)</span> 的值保持不变,而溢出情况则是该和数减去 <span class="arithmatex">\({2}^{w}\)</span> 的结果。</p>
<!-- Media -->

<!-- figureText: $x + \frac{u}{y}$ 溢出 ${2}^{w}$ $0 \bot$ 正常 -->

<p><img src="https://cdn.noedgeai.com/bo_d2ft4sref24c73b0iki0_40.jpg?x=1007&y=751&w=301&h=278&r=0"/></p>
<p>图 2-22 整数加法和无符号加法间的关系。当 <span class="arithmatex">\(x + y\)</span> 大于 <span class="arithmatex">\({2}^{w} - 1\)</span> 时,其和溢出</p>
<!-- Media -->

<p>推导: 无符号数加法</p>
<p>一般而言,我们可以看到,如果 <span class="arithmatex">\(x + y &lt; {2}^{w}\)</span> ,和的 <span class="arithmatex">\(w +\)</span> 1 位表示中的最高位会等于 0 ,因此丢弃它不会改变这个数值。另一方面,如果 <span class="arithmatex">\({2}^{w} \leq  x + y &lt; {2}^{w + 1}\)</span> ,和的 <span class="arithmatex">\(w + 1\)</span> 位表示中的最高位会等于 1 , 因此丢弃它就相当于从和中减去了 <span class="arithmatex">\({2}^{w}\)</span> 。</p>
<p>说一个算术运算溢出, 是指完整的整数结果不能放到数据类型的字长限制中去。如等式 (2.11) 所示,当两个运算数的和为 <span class="arithmatex">\({2}^{w}\)</span> 或者更大时,就发生了溢出。图 2-23 展示了字长 <span class="arithmatex">\(w = 4\)</span> 的无符号加法函数的坐标图。这个和是按模 <span class="arithmatex">\({2}^{4} = {16}\)</span> 计算的。当 <span class="arithmatex">\(x + y &lt; {16}\)</span> 时,没有溢出,并且 <span class="arithmatex">\(x + {}_{4}^{n}y\)</span> 就是 <span class="arithmatex">\(x + y\)</span> 。这对应于图中标记为 “正常” 的斜面。当 <span class="arithmatex">\(x + y \geq  {16}\)</span> 时,加法溢出,结果相当于从和中减去 16 。这对应于图中标记为 “溢出” 的斜面。</p>
<!-- Media -->

<!-- figureText: 16 溢出 14 10 14 12 10 8 6 4 2 0 10 -->

<p><img src="https://cdn.noedgeai.com/bo_d2ft4sref24c73b0iki0_40.jpg?x=277&y=1436&w=849&h=695&r=0"/></p>
<p>图 2-23 无符号加法 ( 4 位字长, 加法是模 16 的 )</p>
<!-- Media -->

<!-- Meanless: 62 第一部分 程序结构和执行-->

<p>当执行 <span class="arithmatex">\(\mathrm{C}\)</span> 程序时,不会将溢出作为错误而发信号。不过有的时候,我们可能希望判定是否发生了溢出。</p>
<p>原理：检测无符号数加法中的溢出</p>
<p>对在范围 <span class="arithmatex">\(0 \leq  x,y \leq  U{\operatorname{Max}}_{w}\)</span> 中的 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> ,令 <span class="arithmatex">\(s \doteq  x + {}_{w}^{u}y\)</span> 。则对计算 <span class="arithmatex">\(s\)</span> ,当且仅当 <span class="arithmatex">\(s &lt; x\)</span> (或者等价地 <span class="arithmatex">\(s &lt; y\)</span> )时,发生了溢出。</p>
<p>作为说明,在前面的示例中,我们看到 <span class="arithmatex">\(9 + {}_{4}^{11}{12} = 5\)</span> 。由于 <span class="arithmatex">\(5 &lt; 9\)</span> ,我们可以看出发生了溢出。</p>
<p>推导: 检测无符号数加法中的溢出</p>
<p>通过观察发现 <span class="arithmatex">\(x + y \geq  x\)</span> ,因此如果 <span class="arithmatex">\(s\)</span> 没有溢出,我们能够肯定 <span class="arithmatex">\(s \geq  x\)</span> 。另一方面,如果 <span class="arithmatex">\(s\)</span> 确实溢出了,我们就有 <span class="arithmatex">\(s = x + y - {2}^{w}\)</span> 。假设 <span class="arithmatex">\(y &lt; {2}^{w}\)</span> ,我们就有 <span class="arithmatex">\(y - {2}^{w} &lt; 0\)</span> ,因此 <span class="arithmatex">\(s = x +\)</span> <span class="arithmatex">\(\left( {y - {2}^{w}}\right)  &lt; x\)</span> 。</p>
<details class="question">
<summary>练习题 2.27</summary>
<p>写出一个具有如下原型的函数：</p>
<hr />
<div class="language-text highlight"><pre><span></span><code>/* Determine whether arguments can be added without overflow */
</code></pre></div>
<p>int uadd_ok(unsigned x, unsigned y);</p>
<hr />
<p>如果参数 <span class="arithmatex">\(\mathrm{x}\)</span> 和 <span class="arithmatex">\(\mathrm{y}\)</span> 相加不会产生溢出,这个函数就返回 1 。</p>
<p>模数加法形成了一种数学结构, 称为阿贝尔群 (Abelian group), 这是以丹麦数学家 Niels Henrik Abel <span class="arithmatex">\(\left( {{1802} \sim  {1829}} \right)\)</span> 的名字命名。也就说,它是可交换的 (这就是为什么叫 “abelian” 的地方)和可结合的。它有一个单位元 0 ,并且每个元素有一个加法逆元。让我们考虑 <span class="arithmatex">\(w\)</span> 位的无符号数的集合,执行加法运算 <span class="arithmatex">\(+ \frac{u}{w}\)</span> 。对于每个值 <span class="arithmatex">\(x\)</span> ,必然有某个值 <span class="arithmatex">\(- \frac{u}{w}x\)</span> 满足 <span class="arithmatex">\(- {}_{w}^{u}x + {}_{w}^{u}x = 0\)</span> 。该加法的逆操作可以表述如下:</p>
<p>原理: 无符号数求反</p>
<p>对满足 <span class="arithmatex">\(0 \leq  x &lt; {2}^{w}\)</span> 的任意 <span class="arithmatex">\(x\)</span> ,其 <span class="arithmatex">\(w\)</span> 位的无符号逆元 <span class="arithmatex">\(- {}_{w}^{u}x\)</span> 由下式给出:</p>
<div class="arithmatex">\[
 - {}_{w}^{u}x = \left\{  \begin{array}{ll} x, &amp; x = 0 \\  {2}^{w} - x, &amp; x &gt; 0 \end{array}\right.  \tag{2. 12}
\]</div>
<p>该结果可以很容易地通过案例分析推导出来:</p>
<p>推导: 无符号数求反</p>
<p>当 <span class="arithmatex">\(x = 0\)</span> 时,加法逆元显然是 0。对于 <span class="arithmatex">\(x &gt; 0\)</span> ,考虑值 <span class="arithmatex">\({2}^{w} - x\)</span> 。我们观察到这个数字在 <span class="arithmatex">\(0 &lt; {2}^{w} - x &lt; {2}^{w}\)</span> 范围之内,并且 <span class="arithmatex">\(\left( {x + {2}^{w} - x}\right) {\;\operatorname{mod}\;{2}^{w}} = {2}^{w}{\;\operatorname{mod}\;{2}^{w}} = 0\)</span> 。因此,它就是 <span class="arithmatex">\(x\)</span> 在 <span class="arithmatex">\({ + }_{w}^{\mathrm{u}}\)</span> 下的逆元。</p>
</details>
<details class="question">
<summary>练习题 2.28</summary>
<p>我们能用一个十六进制数字来表示长度 <span class="arithmatex">\(w = 4\)</span> 的位模式。对于这些数字的无符号解释, 使用等式 (2.12) 填写下表, 给出所示数字的无符号加法逆元的位表示 (用十六进制形式)。</p>
<!-- Media -->
<p><table><tr><td colspan="2"><span class="arithmatex">\(x\)</span></td><td colspan="2"><span class="arithmatex">\(- \frac{u}{4}x\)</span></td></tr><tr><td>十六进制</td><td>十进制</td><td>十进制</td><td>十六进制</td></tr><tr><td>0</td><td/><td/><td/></tr><tr><td>5</td><td/><td/><td/></tr><tr><td>8</td><td/><td/><td/></tr><tr><td>D</td><td/><td/><td/></tr><tr><td>F</td><td/><td/><td/></tr></table></p>
<!-- Media -->
</details>
<h2 id="232">2.3.2 补码加法<a class="headerlink" href="#232" title="Permanent link">&para;</a></h2>
<p>对于补码加法, 我们必须确定当结果太大 (为正) 或者太小 (为负) 时, 应该做些什么。给定在范围 <span class="arithmatex">\(- {2}^{w - 1} \leq  x,y \leq  {2}^{w - 1} - 1\)</span> 之内的整数值 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> ,它们的和就在范围 <span class="arithmatex">\(- {2}^{w} \leq  x +\)</span> <span class="arithmatex">\(y \leq  {2}^{w} - 2\)</span> 之内,要想准确表示,可能需要 <span class="arithmatex">\(w + 1\)</span> 位。就像以前一样,我们通过将表示截断到 <span class="arithmatex">\(w\)</span> 位,来避免数据大小的不断扩张。然而,结果却不像模数加法那样在数学上感觉很熟悉。定义 <span class="arithmatex">\(x + {}_{w}^{t}y\)</span> 为整数和 <span class="arithmatex">\(x + y\)</span> 被截断为 <span class="arithmatex">\(w\)</span> 位的结果,并将这个结果看做是补码数。</p>
<!-- Meanless: 第 2 章 信息的表示和处理 63-->

<p>原理：补码加法</p>
<p>对满足 <span class="arithmatex">\(- {2}^{w - 1} \leq  x,y \leq  {2}^{w - 1} - 1\)</span> 的整数 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> ,有:</p>
<div class="arithmatex">\[
x{ + }_{w}^{\prime }y = \left\{  \begin{array}{lll} x + y - {2}^{w}, &amp; {2}^{w - 1} \leq  x + y &amp; \text{ 正溢 } \\  x + y, &amp;  - {2}^{w - 1} \leq  x + y &lt; {2}^{w - 1} &amp; \text{ 正常 } \\  x + y + {2}^{w}, &amp; x + y &lt;  - {2}^{w - 1} &amp; \text{ 负溢 } \end{array}\right.  \tag{2.13}
\]</div>
<p>图 2-24 说明了这个原理,其中,左边的和 <span class="arithmatex">\(x + y\)</span> 的取值范围为 <span class="arithmatex">\(- {2}^{w} \leq  x + y \leq  {2}^{w} - 2\)</span> ,右边显示的是该和数截断为 <span class="arithmatex">\(w\)</span> 位补码的结果。(图中的标号 “情况 1” 到 “情况 4 ” 用于该原理形式化推导的案例分析中。) 当和 <span class="arithmatex">\(x + y\)</span> 超过 <span class="arithmatex">\({TMa}{x}_{w}\)</span> 时 (情况 4),我们说发生了正溢出。在这种情况下,截断的结果是从和数中减去 <span class="arithmatex">\({2}^{w}\)</span> 。当和 <span class="arithmatex">\(x + y\)</span> 小于 <span class="arithmatex">\({TMi}{n}_{w}\)</span> 时 (情况 1),我们说发生了负溢出。在这种情况下,截断的结果是把和数加上 <span class="arithmatex">\({2}^{w}\)</span> 。</p>
<!-- Media -->

<!-- figureText: $x + y$ $x + y$ $+ {2}^{w - 1}$ -0 $- {2}^{w - 1}$ $+ {2}^{n}$ 正溢出 情况4 情况3 正常 情况 2 $- {2}^{w - 1}$ 情况 1 $- {2}^{w}$ 负溢出 -->

<p><img src="https://cdn.noedgeai.com/bo_d2ft4sref24c73b0iki0_42.jpg?x=845&y=658&w=523&h=520&r=0"/></p>
<p>图 2-24 整数和补码加法之间的关系。当 <span class="arithmatex">\(x + y\)</span> 小于 <span class="arithmatex">\(- {2}^{w - 1}\)</span> 时,产生负溢出。当它大于 <span class="arithmatex">\({2}^{w - 1}\)</span> 时,产生正溢出</p>
<!-- Media -->

<p>两个数的 <span class="arithmatex">\(w\)</span> 位补码之和与无符号之和有完全相同的位级表示。实际上, 大多数计算机使用同样的机器指令来执行无符号或者有符号加法。</p>
<p>推导: 补码加法</p>
<p>既然补码加法与无符号数加法有相同的位级表示, 我们就可以按如下步骤表示运算 <span class="arithmatex">\({ + }_{w}^{\mathrm{t}}\)</span> : 将其参数转换为无符号数, 执行无符号数加法, 再将结果转换为补码:</p>
<div class="arithmatex">\[
x{ + }_{w}^{\mathrm{t}}y \doteq  {U 2}{T}_{w}\left( {{T2}{U}_{w}\left( x\right)  + {}_{w}^{\mathrm{u}} {T 2}{U}_{w}\left( y\right) }\right)  \tag{2.14}
\]</div>
<p>根据等式 (2.6),我们可以把 <span class="arithmatex">\({T 2}{U}_{w}\left( x\right)\)</span> 写成 <span class="arithmatex">\({x}_{w - 1}{2}^{w} + x\)</span> ,把 <span class="arithmatex">\({T 2}{U}_{w}\left( y\right)\)</span> 写成 <span class="arithmatex">\({y}_{w - 1}{2}^{w} + y\)</span> 。使用属性,即 <span class="arithmatex">\(+ {}_{w}^{v}\)</span> 是模 <span class="arithmatex">\({2}^{w}\)</span> 的加法,以及模数加法的属性,我们就能得到:</p>
<div class="arithmatex">\[
x{ + }_{w}^{\mathrm{t}}y = {U 2}{T}_{w}\left( {{T2}{U}_{w}\left( x\right)  + {}_{w}^{\mathrm{u}} {T 2}{U}_{w}\left( y\right) }\right) 
\]</div>
<div class="arithmatex">\[
 = {U 2}{T}_{w}\left\lbrack  {\left( {{x}_{w - 1}{2}^{w} + x + {y}_{w - 1}{2}^{w} + y}\right) {\;\operatorname{mod}\;{2}^{w}} }\right\rbrack  
\]</div>
<div class="arithmatex">\[
 = {U 2}{T}_{w}\left\lbrack  {\left( {x + y}\right) {\;\operatorname{mod}\;{2}^{w}}}\right\rbrack  
\]</div>
<p>消除了 <span class="arithmatex">\({x}_{w - 1}{2}^{w}\)</span> 和 <span class="arithmatex">\({y}_{w - 1}{2}^{w}\)</span> 这两项,因为它们模 <span class="arithmatex">\({2}^{w}\)</span> 等于 0 。</p>
<p>为了更好地理解这个数量,定义 <span class="arithmatex">\(z\)</span> 为整数和 <span class="arithmatex">\(z \doteq  x + y,{z}^{\prime }\)</span> 为 <span class="arithmatex">\({z}^{\prime } \doteq  z{\;\operatorname{mod}\;{2}^{w}}\)</span> ,而 <span class="arithmatex">\({z}^{\prime \prime }\)</span> 为 <span class="arithmatex">\({z}^{\prime \prime } \doteq  {U 2}{T}_{w}\left( {z}^{\prime }\right)\)</span> 。数值 <span class="arithmatex">\({z}^{\prime \prime }\)</span> 等于 <span class="arithmatex">\(x + {}_{w}^{t}y\)</span> 。我们分成 4 种情况分析,如图 2-24 所示。</p>
<p>1) <span class="arithmatex">\(- {2}^{w} \leq  z &lt;  - {2}^{w - 1}\)</span> 。然后,我们会有 <span class="arithmatex">\({z}^{\prime } = z + {2}^{w}\)</span> 。这就得出 <span class="arithmatex">\(0 \leq  {z}^{\prime } &lt;  - {2}^{w - 1} + {2}^{w} =\)</span> <span class="arithmatex">\({2}^{w - 1}\)</span> 。检查等式(2.7),我们看到 <span class="arithmatex">\({z}^{\prime }\)</span> 在满足 <span class="arithmatex">\({z}^{\prime \prime } = {z}^{\prime }\)</span> 的范围之内。这种情况称为负溢出(negative overflow)。我们将两个负数 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 相加 (这是我们能得到 <span class="arithmatex">\(z &lt;  - {2}^{w - 1}\)</span> 的唯一方式),得到一个非负的结果 <span class="arithmatex">\({z}^{\prime \prime } = x + y + {2}^{w}\)</span> 。</p>
<p>2) <span class="arithmatex">\(- {2}^{w - 1} \leq  z &lt; 0\)</span> 。那么,我们又将有 <span class="arithmatex">\({z}^{\prime } = z + {2}^{w}\)</span> ,得到 <span class="arithmatex">\(- {2}^{w - 1} + {2}^{w} = {2}^{w - 1} \leq  {z}^{\prime } &lt; {2}^{w}\)</span> 。检查等式 (2.7),我们看到 <span class="arithmatex">\({z}^{\prime }\)</span> 在满足 <span class="arithmatex">\({z}^{\prime \prime } = {z}^{\prime } - {2}^{w}\)</span> 的范围之内,因此 <span class="arithmatex">\({z}^{\prime \prime } = {z}^{\prime } - {2}^{w} = z + {2}^{w} -\)</span> <span class="arithmatex">\({2}^{w} = z\)</span> 。也就是说,我们的补码和 <span class="arithmatex">\({z}^{\prime \prime }\)</span> 等于整数和 <span class="arithmatex">\(x + y\)</span> 。</p>
<p>3) <span class="arithmatex">\(0 \leq  z &lt; {2}^{w - 1}\)</span> 。那么,我们将有 <span class="arithmatex">\({z}^{\prime } = z\)</span> ,得到 <span class="arithmatex">\(0 \leq  {z}^{\prime } &lt; {2}^{w - 1}\)</span> ,因此 <span class="arithmatex">\({z}^{\prime \prime } = {z}^{\prime } = z\)</span> 。补码和 <span class="arithmatex">\({z}^{\prime \prime }\)</span> 又等于整数和 <span class="arithmatex">\(x + y\)</span> 。</p>
<!-- Meanless: 64 第一部分 程序结构和执行-->

<p>4) <span class="arithmatex">\({2}^{w - 1} \leq  z &lt; {2}^{w}\)</span> 。我们又将有 <span class="arithmatex">\({z}^{\prime } = z\)</span> ,得到 <span class="arithmatex">\({2}^{w - 1} \leq  {z}^{\prime } &lt; {2}^{w}\)</span> 。但是在这个范围内,我们有 <span class="arithmatex">\({z}^{\prime \prime } = {z}^{\prime } - {2}^{w}\)</span> ,得到 <span class="arithmatex">\({z}^{\prime \prime } = x + y - {2}^{w}\)</span> 。这种情况称为正溢出 (positive overflow)。我们将正数 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 相加 (这是我们能得到 <span class="arithmatex">\(z \geq  {2}^{w - 1}\)</span> 的唯一方式),得到一个负数结果 <span class="arithmatex">\({z}^{\prime \prime } = x + y - {2}^{w}\)</span> 。</p>
<p>图 2-25 展示了一些 4 位补码加法的示例作为说明。每个示例的情况都被标号为对应于等式 (2.13) 的推导过程中的情况。注意 <span class="arithmatex">\({2}^{4} = {16}\)</span> ,因此负溢出得到的结果比整数和大 16, 而正溢出得到的结果比之小 16 。我们包括了运算数和结果的位级表示。可以观察到, 能够通过对运算数执行二进制加法并将结果截断到 4 位,从而得到结果。</p>
<!-- Media -->

<table><tr><td>$x$</td><td>$y$</td><td>$x + y$</td><td>$x + \frac{t}{4}y$</td><td>情况</td></tr><tr><td>-8</td><td>-5</td><td>-13</td><td>3</td><td rowspan="2">1</td></tr><tr><td>[1000]</td><td>[1011]</td><td>[10011]</td><td>[0011]</td></tr><tr><td>-8</td><td>-8</td><td>-16</td><td>0</td><td>1</td></tr><tr><td>[1000]</td><td>[1000]</td><td>[10000]</td><td>[0000]</td><td/></tr><tr><td>-8</td><td>5</td><td>-3</td><td>-3</td><td>2</td></tr><tr><td>[1000]</td><td>[0101]</td><td>[11101]</td><td>[1101]</td><td/></tr><tr><td>2</td><td>5</td><td>7</td><td>7</td><td>3</td></tr><tr><td>[0010]</td><td>[0101]</td><td>[00111]</td><td>[0111]</td><td/></tr><tr><td>5</td><td>5</td><td>10</td><td>-6</td><td>4</td></tr><tr><td>[0101]</td><td>[0101]</td><td>[01010]</td><td>[1010]</td><td/></tr></table>

<p>图 2-25 补码加法示例。通过执行运算数的二进制加法并将结果截断到 4 位, 可以获得 4 位补码和的位级表示</p>
<!-- Media -->

<p>图 2-26 阐述了字长 <span class="arithmatex">\(w = 4\)</span> 的补码加法。运算数的范围为 <span class="arithmatex">\(- 8 \sim  7\)</span> 之间。当 <span class="arithmatex">\(x + y &lt;  - 8\)</span> 时,补码加法就会负溢出,导致和增加了 16。当 <span class="arithmatex">\(- 8 \leq  x + y &lt; 8\)</span> 时,加法就产生 <span class="arithmatex">\(x + y\)</span> 。当 <span class="arithmatex">\(x + y \geq  8\)</span> ,加法就会正溢出,使得和减少了 16。这三种情况中的每一种都形成了图中的一个斜面。</p>
<!-- Media -->

<!-- figureText: 正常 正溢出 负溢出 -2 -4 -6 -8 -8 -->

<p><img src="https://cdn.noedgeai.com/bo_d2ft4sref24c73b0iki0_43.jpg?x=405&y=1394&w=841&h=676&r=0"/></p>
<p>图 2-26 补码加法 (字长为 4 位的情况下,当 <span class="arithmatex">\(x + y &lt;  - 8\)</span> 时, 产生负溢出; <span class="arithmatex">\(x + y \geq  8\)</span> 时,产生正溢出)</p>
<!-- Media -->

<!-- Meanless: 第 2 章 信息的表示和处理 65-->

<p>等式 (2.13) 也让我们认出了哪些情况下会发生溢出：</p>
<p>原理: 检测补码加法中的溢出</p>
<p>对满足 <span class="arithmatex">\({TMi}{n}_{w} \leq  x,y \leq  {TMa}{x}_{w}\)</span> 的 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> ,令 <span class="arithmatex">\(s \doteq  x + {}_{w}^{i}y\)</span> 。当且仅当 <span class="arithmatex">\(x &gt; 0,y &gt; 0\)</span> ,但 <span class="arithmatex">\(s \leq  0\)</span> 时,计算 <span class="arithmatex">\(s\)</span> 发生了正溢出。当且仅当 <span class="arithmatex">\(x &lt; 0,y &lt; 0\)</span> ,但 <span class="arithmatex">\(s \geq  0\)</span> 时,计算 <span class="arithmatex">\(s\)</span> 发生了负溢出。</p>
<p>图 2-25 显示了当 <span class="arithmatex">\(w = 4\)</span> 时,这个原理的例子。第一个条目是负溢出的情况,两个负数相加得到一个正数。最后一个条目是正溢出的情况, 两个正数相加得到一个负数。</p>
<p>推导: 检测补码加法中的溢出</p>
<p>让我们先来分析正溢出。如果 <span class="arithmatex">\(x &gt; 0,y &gt; 0\)</span> ,而 <span class="arithmatex">\(s \leq  0\)</span> ,那么显然发生了正溢出。反过来,正溢出的条件为: 1) <span class="arithmatex">\(x &gt; 0,y &gt; 0\)</span> (或者 <span class="arithmatex">\(x + y &lt; {TMa}{x}_{w}\)</span> ),2) <span class="arithmatex">\(s \leq  0\)</span> (见公式 (2.13))。同样的讨论也适用于负溢出情况。</p>
<details class="question">
<summary>练习题 2.29</summary>
<p>按照图 2-25 的形式填写下表。分别列出 5 位参数的整数值、整数和与补码和的数值、补码和的位级表示,以及属于等式 (2.13) 推导中的哪种情况。</p>
<!-- Media -->
<p><table><tr><td><span class="arithmatex">\(x\)</span></td><td><span class="arithmatex">\(y\)</span></td><td><span class="arithmatex">\(x + y\)</span></td><td><span class="arithmatex">\(x + \frac{1}{5}y\)</span></td><td>情况</td></tr><tr><td>[10100]</td><td>[10001]</td><td/><td/><td/></tr><tr><td>[11000]</td><td>[11000]</td><td/><td/><td/></tr><tr><td>[10111]</td><td>[01000]</td><td/><td/><td/></tr><tr><td>[00010]</td><td>[00101]</td><td/><td/><td/></tr><tr><td>[01100]</td><td>[00100]</td><td/><td/><td/></tr></table></p>
<!-- Media -->
</details>
<details class="question">
<summary>练习题 2.30</summary>
<p>写出一个具有如下原型的函数：</p>
<hr />
<p>/<em> Determine whether arguments can be added without overflow </em>/
int tadd_ok( int x, int y ) ;</p>
<hr />
<p>如果参数 <span class="arithmatex">\(\mathrm{x}\)</span> 和 <span class="arithmatex">\(\mathrm{y}\)</span> 相加不会产生溢出,这个函数就返回 1 。</p>
</details>
<details class="question">
<summary>练习题 2.31</summary>
<p>你的同事对你补码加法溢出条件的分析有些不耐烦了,他给出了一个函数 tadd_ok 的实现, 如下所示:</p>
<hr />
<p>/<em> Determine whether arguments can be added without overflow </em>/
/<em> WARNING: This code is buggy. </em>/
int tadd_ok(int x, int y) {
    int sum = x+y;
    return (sum-x == y) &amp;&amp; (sum-y == x);
}</p>
<hr />
<p>你看了代码以后笑了。解释一下为什么。</p>
</details>
<details class="question">
<summary>练习题 2.32</summary>
<p>你现在有个任务,编写函数 tsub_ok 的代码,函数的参数是 <span class="arithmatex">\(\mathrm{x}\)</span> 和 <span class="arithmatex">\(\mathrm{y}\)</span> ,如果计算 <span class="arithmatex">\(\mathrm{x} - \mathrm{y}\)</span> 不产生溢出,函数就返回 1。假设你写的练习题 2.30 的代码如下所示:</p>
<hr />
<p>/<em> Determine whether arguments can be subtracted without overflow </em>/
/<em> WARNING: This code is buggy. </em>/
int tsub_ok( int x, int y ) {
    return tadd_ok(x, -y);</p>
<hr />
<p>}</p>
<p><span class="arithmatex">\(\mathrm{x}\)</span>  和 <span class="arithmatex">\(\mathrm{y}\)</span> 取什么值时,这个函数会产生错误的结果? 写一个该函数的正确版本 (家庭作业 2.74 )。</p>
<!-- Meanless: 66 第一部分 程序结构和执行-->
</details>
<h2 id="233">2.3.3 补码的非<a class="headerlink" href="#233" title="Permanent link">&para;</a></h2>
<p>可以看到范围在 <span class="arithmatex">\({TMi}{n}_{w} \leq  x \leq  {TMa}{x}_{w}\)</span> 中的每个数字 <span class="arithmatex">\(x\)</span> 都有 <span class="arithmatex">\({ + }_{w}^{t}\)</span> 下的加法逆元,我们将 <span class="arithmatex">\(- {}_{w}^{t}x\)</span> 表示如下。</p>
<p>原理: 补码的非</p>
<p>对满足 <span class="arithmatex">\({TMi}{n}_{w} \leq  x \leq  {TMa}{x}_{w}\)</span> 的 <span class="arithmatex">\(x\)</span> ,其补码的非 <span class="arithmatex">\(- {}_{w}^{1}x\)</span> 由下式给出</p>
<div class="arithmatex">\[
 - {}_{w}^{t}x = \left\{  \begin{array}{ll} {TMi}{n}_{w}, &amp; x = {TMi}{n}_{w} \\   - x, &amp; x &gt; {TMi}{n}_{w} \end{array}\right.  \tag{2.15}
\]</div>
<p>也就是说,对 <span class="arithmatex">\(w\)</span> 位的补码加法来说, <span class="arithmatex">\({TMi}{n}_{w}\)</span> 是自己的加法的逆,而对其他任何数值 <span class="arithmatex">\(x\)</span> 都有 <span class="arithmatex">\(- x\)</span> 作为其加法的逆。</p>
<p>推导: 补码的非</p>
<p>观察发现 <span class="arithmatex">\({TMi}{n}_{w} + {TMi}{n}_{w} =  - {2}^{w - 1} + \left( {-{2}^{w - 1}}\right)  =  - {2}^{w}\)</span> 。这将导致负溢出,因此 <span class="arithmatex">\({TMi}{n}_{w} + {}_{w}^{t}{TMi}{n}_{w} =  - {2}^{w} + {2}^{w} = 0\)</span> 。对满足 <span class="arithmatex">\(x &gt; {TMi}{n}_{w}\)</span> 的 <span class="arithmatex">\(x\)</span> ,数值 <span class="arithmatex">\(- x\)</span> 可以表示为一个 <span class="arithmatex">\(w\)</span> 位的补码,它们的和 <span class="arithmatex">\(- x + x = 0\)</span> 。</p>
<p>练习题 2.33 我们可以用一个十六进制数字来表示长度 <span class="arithmatex">\(w = 4\)</span> 的位模式。根据这些数字的补码的解释, 填写下表, 确定所示数字的加法逆元。</p>
<!-- Media -->

<table><tr><td colspan="2">$x$</td><td colspan="2">$- {}_{4}^{t}x$</td></tr><tr><td>十六进制</td><td>十进制</td><td>十进制</td><td>十六进制</td></tr><tr><td>0</td><td/><td/><td/></tr><tr><td>5</td><td/><td/><td/></tr><tr><td>8</td><td/><td/><td/></tr><tr><td>D</td><td/><td/><td/></tr><tr><td>F</td><td/><td/><td/></tr></table>

<!-- Media -->

<p>对于补码和无符号 (练习题 2.28) 非 (negation) 产生的位模式, 你观察到什么?</p>
<details class="info">
<summary>网络旁注 DATA: TNEG| 补码非的位级表示</summary>
</details>
<p>计算一个位级表示的值的补码非有几种聪明的方法。这些技术很有用(例如当你在调试程序的时候遇到值 0 xfffffffa),同时它们也能够让你更了解补码表示的本质。</p>
<p>执行位级补码非的第一种方法是对每一位求补,再对结果加 1 。在 <span class="arithmatex">\(\mathrm{C}\)</span> 语言中,我们可以说,对于任意整数值 <span class="arithmatex">\(\mathrm{x}\)</span> ,计算表达式 <span class="arithmatex">\(- \mathrm{x}\)</span> 和 <span class="arithmatex">\(\sim  \mathrm{x} + 1\)</span> 得到的结果完全一样。</p>
<p>下面是一些示例, 字长为 4 :</p>
<!-- Media -->

<table><tr><td colspan="2">$\overrightarrow{x}$</td><td colspan="2">$\sim  \overrightarrow{x}$</td><td colspan="2">incr(~ $\overrightarrow{x}$ )</td></tr><tr><td>[0101]</td><td>5</td><td>[1010]</td><td>-6</td><td>[1011]</td><td>-5</td></tr><tr><td>[0111]</td><td>7</td><td>[1000]</td><td>-8</td><td>[1001]</td><td>-7</td></tr><tr><td>[1100]</td><td>-4</td><td>[0011]</td><td>3</td><td>[0100]</td><td>4</td></tr><tr><td>[0000]</td><td>0</td><td>[1111]</td><td>-1</td><td>[0000]</td><td>0</td></tr><tr><td>[1000]</td><td>-8</td><td>[0111]</td><td>7</td><td>[1000]</td><td>-8</td></tr></table>

<!-- Media -->

<p>从前面的例子我们知道 0 xf 的补是 0 x 0 ,而 0 xa 的补是 0 x 5 ,因而 0 xfffffffa 是 -6 的补码表示。</p>
<p>计算一个数 <span class="arithmatex">\(x\)</span> 的补码非的第二种方法是建立在将位向量分为两部分的基础之上的。假设 <span class="arithmatex">\(k\)</span> 是最右边的 1 的位置,因而 <span class="arithmatex">\(x\)</span> 的位级表示形如 <span class="arithmatex">\(\left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{k + 1},1,0,\cdots ,0}\right\rbrack\)</span> 。 (只要 <span class="arithmatex">\(x \neq  0\)</span> 就能够找到这样的 <span class="arithmatex">\({k}_{0}\)</span> ) 这个值的非写成二进制格式就是 <span class="arithmatex">\(\left\lbrack  { \sim  {x}_{w - 1}} \right. , \sim  {x}_{w - 2},\cdots\)</span> , <span class="arithmatex">\(\left. { \sim  {x}_{k + 1},1,0,\cdots ,0}\right\rbrack\)</span> 。也就是,我们对位 <span class="arithmatex">\(k\)</span> 左边的所有位取反。</p>
<!-- Meanless: 第 2 章 信息的表示和处理 67-->

<p>我们用一些 4 位数字来说明这个方法,这里我们用斜体来突出最右边的模式 <span class="arithmatex">\(1,0,\cdots ,0\)</span> :</p>
<!-- Media -->

<table><tr><td>$x$</td><td colspan="2">$- x$</td></tr><tr><td>[1100]- 4</td><td>[0100]</td><td>4</td></tr><tr><td>[1000]-8</td><td>[1000]</td><td>-8</td></tr><tr><td>[010]5</td><td>[101]</td><td>-5</td></tr><tr><td>[011]7</td><td>[100]</td><td>-7</td></tr></table>

<!-- Media -->

<h2 id="234">2.3.4 无符号乘法<a class="headerlink" href="#234" title="Permanent link">&para;</a></h2>
<p>范围在 <span class="arithmatex">\(0 \leq  x,y \leq  {2}^{w} - 1\)</span> 内的整数 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 可以被表示为 <span class="arithmatex">\(w\)</span> 位的无符号数,但是它们的乘积 <span class="arithmatex">\(x \cdot  y\)</span> 的取值范围为 0 到 <span class="arithmatex">\({\left( {2}^{w} - 1\right) }^{2} = {2}^{2 w} - {2}^{w + 1} + 1\)</span> 之间。这可能需要 <span class="arithmatex">\({2 w}\)</span> 位来表示。不过, <span class="arithmatex">\(\mathrm{C}\)</span> 语言中的无符号乘法被定义为产生 <span class="arithmatex">\(w\)</span> 位的值,就是 <span class="arithmatex">\({2 w}\)</span> 位的整数乘积的低 <span class="arithmatex">\(w\)</span> 位表示的值。我们将这个值表示为 <span class="arithmatex">\(x * {}_{w}^{\mathrm{u}}y\)</span> 。</p>
<p>将一个无符号数截断为 <span class="arithmatex">\(w\)</span> 位等价于计算该值模 <span class="arithmatex">\({2}^{w}\)</span> ,得到:</p>
<p>原理：无符号数乘法</p>
<p>对满足 <span class="arithmatex">\(0 \leq  x,y \leq  U{\operatorname{Max}}_{w}\)</span> 的 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 有:</p>
<div class="arithmatex">\[
x * {}_{w}^{u}y = \left( {x \cdot  y}\right) {\;\operatorname{mod}\;{2}^{w}} \tag{2.16}
\]</div>
<h2 id="235">2.3.5 补码乘法<a class="headerlink" href="#235" title="Permanent link">&para;</a></h2>
<p>范围在 <span class="arithmatex">\(- {2}^{w - 1} \leq  x,y \leq  {2}^{w - 1} - 1\)</span> 内的整数 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 可以被表示为 <span class="arithmatex">\(w\)</span> 位的补码数字,但是它们的乘积 <span class="arithmatex">\(x \cdot  y\)</span> 的取值范围为 <span class="arithmatex">\(- {2}^{w - 1} \cdot  \left( {{2}^{w - 1} - 1}\right)  =  - {2}^{{2 w} - 2} + {2}^{w - 1}\)</span> 到 <span class="arithmatex">\(- {2}^{w - 1} \cdot   - {2}^{w - 1} =\)</span> <span class="arithmatex">\(- {2}^{{2 w} - 2}\)</span> 之间。要想用补码来表示这个乘积,可能需要 <span class="arithmatex">\({2 w}\)</span> 位。然而, <span class="arithmatex">\(\mathrm{C}\)</span> 语言中的有符号乘法是通过将 <span class="arithmatex">\({2 w}\)</span> 位的乘积截断为 <span class="arithmatex">\(w\)</span> 位来实现的。我们将这个数值表示为 <span class="arithmatex">\(x * {}_{w}^{t}y\)</span> 。将一个补码数截断为 <span class="arithmatex">\(w\)</span> 位相当于先计算该值模 <span class="arithmatex">\({2}^{w}\)</span> ,再把无符号数转换为补码,得到:</p>
<p>原理：补码乘法</p>
<p>对满足 <span class="arithmatex">\({TMi}{n}_{w} \leq  x,y \leq  {TMa}{x}_{w}\)</span> 的 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 有:</p>
<div class="arithmatex">\[
x * {}_{w}^{\mathrm{t}}y = {U 2}{T}_{w}\left( {\left( {x \cdot  y}\right) {\;\operatorname{mod}\;{2}^{w}}}\right)  \tag{2.17}
\]</div>
<p>我们认为对于无符号和补码乘法来说, 乘法运算的位级表示都是一样的, 并用如下原理说明:</p>
<p>原理：无符号和补码乘法的位级等价性</p>
<p>给定长度为 <span class="arithmatex">\(w\)</span> 的位向量 <span class="arithmatex">\(\overrightarrow{x}\)</span> 和 <span class="arithmatex">\(\overrightarrow{y}\)</span> ,用补码形式的位向量表示来定义整数 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y : x =\)</span> <span class="arithmatex">\({B 2}{T}_{w}\left( \overrightarrow{x}\right) ,y = {B 2}{T}_{w}\left( \overrightarrow{y}\right)\)</span> 。用无符号形式的位向量表示来定义非负整数 <span class="arithmatex">\({x}^{\prime }\)</span> 和 <span class="arithmatex">\({y}^{\prime } : {x}^{\prime } =\)</span> <span class="arithmatex">\({B 2}{U}_{w}\left( \overrightarrow{x}\right) ,{y}^{\prime } = {B 2}{U}_{w}\left( \overrightarrow{y}\right)\)</span> 。则</p>
<div class="arithmatex">\[
{T 2}{B}_{w}\left( {x * {}_{w}^{\mathrm{t}}y}\right)  = {U 2}{B}_{w}\left( {{x}^{\prime } * {}_{w}^{\mathrm{u}} {y}^{\prime }}\right) 
\]</div>
<p>作为说明, 图 2-27 给出了不同 3 位数字的乘法结果。对于每一对位级运算数, 我们执行无符号和补码乘法, 得到 6 位的乘积, 然后再把这些乘积截断到 3 位。无符号的截断后的乘积总是等于 <span class="arithmatex">\(x \cdot  y{\;\operatorname{mod}\;8}\)</span> 。虽然无符号和补码两种乘法乘积的 6 位表示不同,但是截断后的乘积的位级表示都相同。</p>
<p>推导: 无符号和补码乘法的位级等价性</p>
<p>根据等式 (2.6),我们有 <span class="arithmatex">\({x}^{\prime } = x + {x}_{w - 1}{2}^{w}\)</span> 和 <span class="arithmatex">\({y}^{\prime } = y + {y}_{w - 1}{2}^{w}\)</span> 。计算这些值的乘积模 <span class="arithmatex">\({2}^{w}\)</span> 得到以下结果:</p>
<div class="arithmatex">\[
\left( {{x}^{\prime } \cdot  {y}^{\prime }} \right) {\;\operatorname{mod}\;{2}^{w}} = \left\lbrack  {\left( {x + {x}_{w - 1}{2}^{w}}\right)  \cdot  \left( {y + {y}_{w - 1}{2}^{w}}\right) }\right\rbrack  {\;\operatorname{mod}\;{2}^{w}}
\]</div>
<!-- Meanless: 68 第一部分 程序结构和执行-->

<div class="arithmatex">\[
 = \left\lbrack  {x \cdot  y + \left( {{x}_{w - 1}y + {y}_{w - 1}x}\right) {2}^{w} + {x}_{w - 1}{y}_{w - 1}{2}^{2w}} \right\rbrack  {\;\operatorname{mod}\;{2}^{w}} \tag{2.18}
\]</div>
<div class="arithmatex">\[
 = \left( {x \cdot  y}\right) {\;\operatorname{mod}\;{2}^{w}}
\]</div>
<p>由于模运算符,所有带有权重 <span class="arithmatex">\({2}^{w}\)</span> 和 <span class="arithmatex">\({2}^{2 w}\)</span> 的项都丢掉了。根据等式 (2.17),我们有 <span class="arithmatex">\(x * {}_{w}^{t}y =\)</span> <span class="arithmatex">\({U 2}{T}_{w}\left( {\left( {x \cdot  y}\right) {\;\operatorname{mod}\;{2}^{w}}}\right)\)</span> 。对等式两边应用操作 <span class="arithmatex">\({T 2}{U}_{w}\)</span> 有：</p>
<div class="arithmatex">\[
{T 2}{U}_{w}\left( {x * {}_{w}^{\mathrm{t}}y}\right)  = {T 2}{U}_{w}\left( {{U2}{T}_{w}\left( {\left( {x \cdot  y}\right) {\;\operatorname{mod}\;{2}^{w}} }\right) }\right)  = \left( {x \cdot  y}\right) {\;\operatorname{mod}\;{2}^{w}}
\]</div>
<p>将上述结果与式 (2.16) 和式 (2.18) 结合起来得到 <span class="arithmatex">\({T 2}{U}_{w}\left( {x{ * }_{w}^{\mathrm{t}}y}\right)  = \left( {{x}^{\prime } \cdot  {y}^{\prime }} \right) {\;\operatorname{mod}\;{2}^{w}} =\)</span> <span class="arithmatex">\({x}^{\prime } * {}_{w}^{\prime }{y}^{\prime }\)</span> 。然后对这个等式的两边应用 <span class="arithmatex">\({U 2}{B}_{w}\)</span> ,得到</p>
<p><span class="arithmatex">\({U 2}{B}_{w}\left( {{T2}{U}_{w}\left( {x{ * }_{w}^{\prime }y}\right) }\right)  = {T2}{B}_{w}\left( {x{ * }_{w}^{\prime }y}\right)  = {U2}{B}_{w}\left( {{x}^{\prime }{ * }_{w}^{\prime }{y}^{\prime }} \right)\)</span></p>
<!-- Media -->

<table><tr><td>模式</td><td colspan="2">$x$</td><td colspan="2">$y$</td><td colspan="2">$x \cdot  y$</td><td colspan="2">截断的 $x \cdot  y$</td></tr><tr><td>无符号</td><td>5</td><td>[101]</td><td>3</td><td>[011]</td><td>15</td><td>[001111]</td><td>7</td><td>[111]</td></tr><tr><td>补码</td><td>-3</td><td>[101]</td><td>3</td><td>[011]</td><td>-9</td><td>[110111]</td><td>-1</td><td>[111]</td></tr><tr><td>无符号</td><td>4</td><td>[100]</td><td>7</td><td>[111]</td><td>28</td><td>[011100]</td><td>4</td><td>[100]</td></tr><tr><td>补码</td><td>-4</td><td>[100]</td><td>-1</td><td>[111]</td><td>4</td><td>[000100]</td><td>-4</td><td>[100]</td></tr><tr><td>无符号</td><td>3</td><td>[011]</td><td>3</td><td>[011]</td><td>9</td><td>[001001]</td><td>1</td><td>[001]</td></tr><tr><td>补码</td><td>3</td><td>[011]</td><td>3</td><td>[011]</td><td>9</td><td>[001001]</td><td>1</td><td>[001]</td></tr></table>

<p>图 2-27 3 位无符号和补码乘法示例。虽然完整的乘积的位级表示可能会不同, 但是截断后乘积的位级表示是相同的</p>
<!-- Media -->

<details class="question">
<summary>练习题 2.34</summary>
<p>按照图 2-27 的风格填写下表,说明不同的 3 位数字乘法的结果。</p>
<!-- Media -->
<p><table><tr><td>模式</td><td><span class="arithmatex">\(x\)</span></td><td><span class="arithmatex">\(y\)</span></td><td><span class="arithmatex">\(x \cdot  y\)</span></td><td>截断的 <span class="arithmatex">\(x \cdot  y\)</span></td></tr><tr><td>无符号</td><td>[100]</td><td>[101]</td><td/><td/></tr><tr><td>补码</td><td>[100]</td><td>[101]</td><td/><td/></tr><tr><td>无符号</td><td>[010]</td><td>[111]</td><td/><td/></tr><tr><td>补码</td><td>[010]</td><td>[111]</td><td/><td/></tr><tr><td>无符号</td><td>[110]</td><td>[110]</td><td/><td/></tr><tr><td>补码</td><td>[110]</td><td>[110]</td><td/><td/></tr></table></p>
<!-- Media -->
</details>
<details class="question">
<summary>练习题 2.35</summary>
<p>给你一个任务,开发函数 tmult_ok 的代码, 该函数会判断两个参数相乘是否会产生溢出。下面是你的解决方案:</p>
<hr />
<p>/<em> Determine whether arguments can be multiplied without overflow </em>/
int tmult_ok( int x, int y ) {
    int <span class="arithmatex">\(\mathrm{p} = \mathrm{x} * \mathrm{y}\)</span> ;
    /* Either <span class="arithmatex">\(x\)</span> is zero,or dividing <span class="arithmatex">\(p\)</span> by <span class="arithmatex">\(x\)</span> gives <span class="arithmatex">\(y *\)</span> /
    return !x || p/x == y;</p>
<hr />
<p>}</p>
<p>你用 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 的很多值来测试这段代码,似乎都工作正常。你的同事挑战你,说: “如果我不能用减法来检验加法是否溢出(参见练习题 2.31),那么你怎么能用除法来检验乘法是否溢出呢?”</p>
<p>按照下面的思路,用数学推导来证明你的方法是对的。首先,证明 <span class="arithmatex">\(x = 0\)</span> 的情况是正确的。另外,考虑 <span class="arithmatex">\(w\)</span> 位数字 <span class="arithmatex">\(x\left( {x \neq  0}\right) \text{、}y\text{、}p\)</span> 和 <span class="arithmatex">\(q\)</span> ,这里 <span class="arithmatex">\(p\)</span> 是 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 补码乘法的结果,而 <span class="arithmatex">\(q\)</span> 是 <span class="arithmatex">\(p\)</span> 除以 <span class="arithmatex">\(x\)</span> 的结果。</p>
<p>1) 说明 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 的整数乘积 <span class="arithmatex">\(x \cdot  y\)</span> ,可以写成这样的形式: <span class="arithmatex">\(x \cdot  y = p + t{2}^{w}\)</span> ,其中, <span class="arithmatex">\(t \neq  0\)</span> 当且仅当 <span class="arithmatex">\(p\)</span> 的计算溢出。</p>
<!-- Meanless: 第 2 章 信息的表示和处理 69-->
<p>2) 说明 <span class="arithmatex">\(p\)</span> 可以写成这样的形式: <span class="arithmatex">\(p = x \cdot  q + r\)</span> ,其中 <span class="arithmatex">\(\left| r\right|  &lt; \left| x\right|\)</span> 。</p>
<p>3) 说明 <span class="arithmatex">\(q = y\)</span> 当且仅当 <span class="arithmatex">\(r = t = 0\)</span> 。</p>
</details>
<details class="question">
<summary>练习题 2.36</summary>
<p>对于数据类型 int 为 32 位的情况, 设计一个版本的 tmult_ok 函数(练习题 2.35), 使用 64 位精度的数据类型 int 64_t, 而不使用除法。</p>
</details>
<details class="info">
<summary>旁注|XDR 库中的安全漏洞</summary>
<p>2002 年,人们发现 Sun Microsystems 公司提供的实现 XDR 库的代码有安全漏洞, XDR 库是一个广泛使用的、程序间共享数据结构的工具, 造成这个安全漏洞的原因是程序会在毫无察觉的情况下产生乘法溢出。包含安全漏洞的代码与下面所示类似：</p>
<hr />
<p>/<em> Illustration of code vulnerability similar to that found in
* Sun's XDR library.
</em>/
void<em> copy_elements(void </em>ele_src[], int ele_cnt, size_t ele_size) {
    /<em>
        * Allocate buffer for ele_cnt objects, each of ele_size bytes
        * and copy from locations designated by ele_src
        </em>/
    void <em>result = malloc(ele_cnt * ele_size);
    if (result == NULL)
            /</em> malloc failed <em>/
            return NULL;
    void </em>next = result;
    int i;
    for (i = 0; i &lt; ele_cnt; i++) {
            /<em> Copy object i to destination </em>/
            memcpy(next, ele_src[i], ele_size);
            /<em> Move pointer to next memory region </em>/
            next += ele_size;
    }
    return result;
}</p>
<hr />
<p>函数 copy_elements 设计用来将 ele_cnt 个数据结构复制到第 9 行的函数分配的缓冲区中,每个数据结构包含 ele_size 个字节。需要的字节数是通过计算 ele_cnt * ele_size 得到的。</p>
<p>想象一下,一个怀有恶意的程序员在被编译为 32 位的程序中用参数 ele_cnt 等于 <span class="arithmatex">\({1048577}\left( {{2}^{20} + 1}\right)\)</span> 、ele_size 等于 4096 <span class="arithmatex">\(\left( {2}^{12}\right)\)</span> 来调用这个函数。然后第 9 行上的乘法会溢出,导致只会分配 4096 个字节,而不是装下这些数据所需要的 4 294 971 392 个字节。从第 15 行开始的循环会试图复制所有的字节, 超越已分配的缓冲区的界限, 因而破坏了其他的数据结构。这会导致程序崩溃或者行为异常。</p>
<p>几乎每个操作系统都使用了这段 Sun 的代码, 像 Internet Explorer 和 Kerberos 验证系统这样使用广泛的程序都用到了它。计算机紧急响应组 (Computer Emergency Response Team, CERT), 由卡内基-梅隆软件工程协会(Carnegie Mellon Software Engineering Institute) 运作的一个追踪安全漏洞或失效的组织, 发布了建议 “CA-2002-25”,于是许多公司急忙对它们的代码打补丁。幸运的是,还没有由于这个漏洞引起的安全失效的报告。</p>
<p>库函数 calloc 的实现中存在着类似的漏洞。这些已经被修补过了。遗憾的是,许多程序员调用分配函数 (如 malloc) 时, 使用算术表达式作为参数, 并且不对这些表达式进行溢出检查。编写 calloc 的可靠版本留作一道练习题(家庭作业 2.76)。</p>
</details>
<!-- Meanless: 70 第一部分 程序结构和执行-->

<details class="question">
<summary>练习题 2.37</summary>
<p>现在你有一个任务, 当数据类型 int 和 size_t 都是 32 位的, 修补上述旁注给出的 XDR 代码中的漏洞。你决定将待分配字节数设置为数据类型 uint 64_t, 来消除乘法溢出的可能性。你把原来对 malloc 函数的调用 (第 9 行) 替换如下:</p>
<hr />
<p>uint 64_t asize =
    ele_cnt * (uint 64_t) ele_size;
void *result = malloc(asize);</p>
<hr />
<p>提醒一下,malloc 的参数类型是 size_t。</p>
<p>A. 这段代码对原始的代码有了哪些改进?</p>
<p>B. 你该如何修改代码来消除这个漏洞?</p>
</details>
<h2 id="236">2.3.6 乘以常数<a class="headerlink" href="#236" title="Permanent link">&para;</a></h2>
<p>以往,在大多数机器上,整数乘法指令相当慢,需要 10 个或者更多的时钟周期,然而其他整数运算 (例如加法、减法、位级运算和移位) 只需要 1 个时钟周期。即使在我们的参考机器 Intel Core i 7 Haswell 上, 其整数乘法也需要 3 个时钟周期。因此, 编译器使用了一项重要的优化, 试着用移位和加法运算的组合来代替乘以常数因子的乘法。首先, 我们会考虑乘以 2 的幂的情况, 然后再概括成乘以任意常数。</p>
<p>原理：乘以 2 的幂</p>
<p>设 <span class="arithmatex">\(x\)</span> 为位模式 <span class="arithmatex">\(\left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{0}} \right\rbrack\)</span> 表示的无符号整数。那么,对于任何 <span class="arithmatex">\(k \geq  0\)</span> ,我们都认为 <span class="arithmatex">\(\left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{0},0,\cdots ,0}\right\rbrack\)</span> 给出了 <span class="arithmatex">\(x{2}^{k}\)</span> 的 <span class="arithmatex">\(w + k\)</span> 位的无符号表示,这里右边增加了 <span class="arithmatex">\(k\)</span> 个 0 。</p>
<p>因此,比如,当 <span class="arithmatex">\(w = 4\)</span> 时,11 可以被表示为 <span class="arithmatex">\(\left\lbrack  {1011}\right\rbrack\)</span> 。 <span class="arithmatex">\(k = 2\)</span> 时将其左移得到 6 位向量 <span class="arithmatex">\(\left\lbrack  {101100}\right\rbrack\)</span> ,即可编码为无符号数 <span class="arithmatex">\({11} \cdot  4 = {44}\)</span> 。</p>
<p>推导: 乘以 2 的幂</p>
<p>这个属性可以通过等式 (2.1) 推导出来:</p>
<div class="arithmatex">\[
{B 2}{U}_{w + k}\left( \left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{0},0,\cdots ,0}\right\rbrack  \right)  = \mathop{\sum }\limits_{{i = 0}} ^ {{w - 1}} {x}_{i}{2}^{i + k}
\]</div>
<div class="arithmatex">\[
 = \left\lbrack  {\mathop{\sum }\limits_ {{i = 0}} ^ {{w - 1}} {x}_{i}{2}^{i}}\right\rbrack   \cdot  {2}^{k}
\]</div>
<div class="arithmatex">\[
 = x{2}^{k}
\]</div>
<p>当对固定字长左移 <span class="arithmatex">\(k\)</span> 位时,其高 <span class="arithmatex">\(k\)</span> 位被丢弃,得到</p>
<div class="arithmatex">\[
\left\lbrack  {{x}_{w - k - 1},{x}_{w - k - 2},\cdots ,{x}_{0},0,\cdots ,0}\right\rbrack  
\]</div>
<p>而执行固定字长的乘法也是这种情况。因此, 我们可以看出左移一个数值等价于执行一个与 2 的幂相乘的无符号乘法。</p>
<p>原理：与 2 的幂相乘的无符号乘法</p>
<p><span class="arithmatex">\(\mathrm{C}\)</span> 变量 <span class="arithmatex">\(\mathrm{x}\)</span> 和 <span class="arithmatex">\(\mathrm{k}\)</span> 有无符号数值 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(k\)</span> ,且 <span class="arithmatex">\(0 \leq  k &lt; w\)</span> ,则 <span class="arithmatex">\(\mathrm{C}\)</span> 表达式 <span class="arithmatex">\(\mathrm{x} &lt; \mathrm{k}\)</span> 产生数值 <span class="arithmatex">\(x * {}_{w}^{1}{2}^{k}\)</span> 。</p>
<p>由于固定大小的补码算术运算的位级操作与其无符号运算等价, 我们就可以对补码运算的 2 的幂的乘法与左移之间的关系进行类似的表述:</p>
<p>原理: 与 2 的幂相乘的补码乘法</p>
<p><span class="arithmatex">\(\mathrm{C}\)</span> 变量 <span class="arithmatex">\(\mathrm{x}\)</span> 和 <span class="arithmatex">\(\mathrm{k}\)</span> 有补码值 <span class="arithmatex">\(x\)</span> 和无符号数值 <span class="arithmatex">\(k\)</span> ,且 <span class="arithmatex">\(0 \leq  k &lt; w\)</span> ,则 <span class="arithmatex">\(\mathrm{C}\)</span> 表达式 <span class="arithmatex">\(\mathrm{x} &lt; \mathrm{k}\)</span> 产生数值 <span class="arithmatex">\(x * {}_{w}^{1}{2}^{k}\)</span> 。</p>
<!-- Meanless: 第 2 章 信息的表示和处理 71-->

<p>注意, 无论是无符号运算还是补码运算, 乘以 2 的幂都可能会导致溢出。结果表明, 即使溢出的时候, 我们通过移位得到的结果也是一样的。回到前面的例子, 我们将 4 位模式<a href="数值为 11">1011</a> 左移两位得到 <a href="数值为 44">101100</a>。将这个值截断为 4 位得到 <span class="arithmatex">\(\left\lbrack  {1100}\right\rbrack\)</span> (数值为 <span class="arithmatex">\({12} = {44}{\;\operatorname{mod}\;{16}}\)</span> )。</p>
<p>由于整数乘法比移位和加法的代价要大得多,许多 <span class="arithmatex">\(\mathrm{C}\)</span> 语言编译器试图以移位、加法和减法的组合来消除很多整数乘以常数的情况。例如,假设一个程序包含表达式 <span class="arithmatex">\(\mathrm{x} * {14}\)</span> 。利用 <span class="arithmatex">\({14} = {2}^{3} + {2}^{2} + {2}^{1}\)</span> ,编译器会将乘法重写为 <span class="arithmatex">\(\left( {\mathrm{x} &lt;  &lt; 3}\right)  + \left( {\mathrm{x} &lt;  &lt; 2}\right)  + \left( {\mathrm{x} &lt;  &lt; 1}\right)\)</span> ,将一个乘法替换为三个移位和两个加法。无论 <span class="arithmatex">\(\mathrm{x}\)</span> 是无符号的还是补码,甚至当乘法会导致溢出时,两个计算都会得到一样的结果。(根据整数运算的属性可以证明这一点。)更好的是,编译器还可以利用属性 <span class="arithmatex">\({14} = {2}^{4} - {2}^{1}\)</span> ,将乘法重写为 <span class="arithmatex">\(\left( {\mathrm{x} &lt;  &lt; 4}\right)  - \left( {\mathrm{x} &lt;  &lt; 1}\right)\)</span> ,这时只需要两个移位和一个减法。</p>
<details class="question">
<summary>练习题 2.38</summary>
<p>就像我们将在第 3 章中看到的那样, LEA 指令能够执行形如 (a&lt;&lt;k) +b 的计算,这里 <span class="arithmatex">\(\mathrm{k}\)</span> 等于 0、1、2 或 3,而 <span class="arithmatex">\(\mathrm{b}\)</span> 等于 0 或者某个程序值。编译器常常用这条指令来执行常数因子乘法。例如,我们可以用 <span class="arithmatex">\(\left( {a &lt;  &lt; 1}\right)  + a\)</span> 来计算 <span class="arithmatex">\(3 * a\)</span> 。</p>
<p>考虑 <span class="arithmatex">\(\mathrm{b}\)</span> 等于 0 或者等于 <span class="arithmatex">\(\mathrm{a}\)</span> 、 <span class="arithmatex">\(\mathrm{k}\)</span> 为任意可能的值的情况,用一条 LEA 指令可以计算 a 的哪些倍数?</p>
<p>归纳一下我们的例子,考虑一个任务,对于某个常数 <span class="arithmatex">\(K\)</span> 的表达式 <span class="arithmatex">\(\mathrm{x} * K\)</span> 生成代码。编译器会将 <span class="arithmatex">\(K\)</span> 的二进制表示表达为一组 0 和 1 交替的序列:</p>
<div class="arithmatex">\[
\left\lbrack  {\left( {0\cdots 0}\right) \left( {1\cdots 1}\right) \left( {0\cdots 0}\right) \cdots \left( {1\cdots 1}\right) }\right\rbrack  
\]</div>
<p>例如,14 可以写成 <span class="arithmatex">\(\left\lbrack  {\left( {0\cdots 0}\right) \left( {111}\right) \left( 0\right) }\right\rbrack\)</span> 。考虑一组从位位置 <span class="arithmatex">\(n\)</span> 到位位置 <span class="arithmatex">\(m\)</span> 的连续的 <span class="arithmatex">\(1(n \geq\)</span> <span class="arithmatex">\(m)\)</span> 。(对于 14 来说,我们有 <span class="arithmatex">\(n = 3\)</span> 和 <span class="arithmatex">\(m = 1\)</span> 。)我们可以用下面两种不同形式中的一种来计算这些位对乘积的影响:</p>
<p>形式 A: <span class="arithmatex">\(\left( {\mathrm{x} &lt;  &lt; n}\right)  + \left( {\mathrm{x} &lt;  &lt; \left( {n - 1}\right) }\right)  + \cdots  + \left( {\mathrm{x} &lt;  &lt; m}\right)\)</span></p>
<p>形式 B: <span class="arithmatex">\(\left( {\mathrm{x} &lt;  &lt; \left( {n + 1}\right) }\right)  - \left( {\mathrm{x} &lt;  &lt; m}\right)\)</span></p>
<p>把每个这样连续的 1 的结果加起来,不用做任何乘法,我们就能计算出 <span class="arithmatex">\(\mathrm{x} * K\)</span> 。当然,选择使用移位、加法和减法的组合, 还是使用一条乘法指令, 取决于这些指令的相对速度, 而这些是与机器高度相关的。大多数编译器只在需要少量移位、加法和减法就足够的时候才使用这种优化。</p>
</details>
<details class="question">
<summary>练习题 2.39</summary>
<p>对于位位置 <span class="arithmatex">\(n\)</span> 为最高有效位的情况,我们要怎样修改形式 <span class="arithmatex">\(\mathrm{B}\)</span> 的表达式? </p>
</details>
<details class="question">
<summary>练习题 2.40</summary>
<p>对于下面每个 <span class="arithmatex">\(K\)</span> 的值,找出只用指定数量的运算表达 <span class="arithmatex">\(\mathrm{x} * K\)</span> 的方法, 这里我们认为加法和减法的开销相当。除了我们已经考虑过的简单的形式 <span class="arithmatex">\(\mathrm{A}\)</span> 和 <span class="arithmatex">\(\mathrm{B}\)</span> 原则,你可能会需要使用一些技巧。</p>
<!-- Media -->
<p><table><tr><td><span class="arithmatex">\(K\)</span></td><td>移位</td><td>加法/减法</td><td>表达式</td></tr><tr><td>6</td><td>2</td><td>1</td><td/></tr><tr><td>31</td><td>1</td><td>1</td><td/></tr><tr><td>-6</td><td>2</td><td>1</td><td/></tr><tr><td>55</td><td>2</td><td>2</td><td/></tr></table></p>
<!-- Media -->
</details>
<details class="question">
<summary>练习题 2.41</summary>
<p>对于一组从位位置 <span class="arithmatex">\(n\)</span> 开始到位位置 <span class="arithmatex">\(m\)</span> 的连续的 <span class="arithmatex">\(1\left( {n \geq  m}\right)\)</span> ,我们看到可以产生两种形式的代码, A 和 B。编译器该如何决定使用哪一种呢?</p>
</details>
<h2 id="237-2">2.3.7 除以 2 的幂<a class="headerlink" href="#237-2" title="Permanent link">&para;</a></h2>
<p>在大多数机器上,整数除法要比整数乘法更慢——需要 30 个或者更多的时钟周期。除以 2 的幂也可以用移位运算来实现, 只不过我们用的是右移, 而不是左移。无符号和补码数分别使用逻辑移位和算术移位来达到目的。</p>
<!-- Meanless: 72 第一部分 程序结构和执行-->

<p>整数除法总是舍入到零。为了准确进行定义,我们要引入一些符号。对于任何实数 <span class="arithmatex">\(a\)</span> , 定义 <span class="arithmatex">\(\left\lfloor  a\right\rfloor\)</span> 为唯一的整数 <span class="arithmatex">\({a}^{\prime }\)</span> ,使得 <span class="arithmatex">\({a}^{\prime } \leq  a &lt; {a}^{\prime } + 1\)</span> 。例如, <span class="arithmatex">\(\left\lfloor  {3.14}\right\rfloor   = 3,\left\lfloor  {-{3.14}}\right\rfloor   =  - 4\)</span> 而 <span class="arithmatex">\(\left\lfloor  3\right\rfloor   =\)</span> 3。同样,定义 <span class="arithmatex">\(\left\lbrack  a\right\rbrack\)</span> 为唯一的整数 <span class="arithmatex">\({a}^{\prime }\)</span> ,使得 <span class="arithmatex">\({a}^{\prime } - 1 &lt; a \leq  {a}^{\prime }\)</span> 。例如, <span class="arithmatex">\(\left\lbrack  {3.14}\right\rbrack   = 4,\left\lbrack  {-{3.14}}\right\rbrack   =  - 3\)</span> , 而 <span class="arithmatex">\(\left\lceil  3\right\rceil   = 3\)</span> 。对于 <span class="arithmatex">\(x \geq  0\)</span> 和 <span class="arithmatex">\(y &gt; 0\)</span> ,结果会是 <span class="arithmatex">\(\left\lfloor  {x/y}\right\rfloor\)</span> ,而对于 <span class="arithmatex">\(x &lt; 0\)</span> 和 <span class="arithmatex">\(y &gt; 0\)</span> ,结果会是 <span class="arithmatex">\(\left\lceil  {x/y}\right\rceil\)</span> 。也就是说, 它将向下舍入一个正值, 而向上舍入一个负值。</p>
<p>对无符号运算使用移位是非常简单的, 部分原因是由于无符号数的右移一定是逻辑右移。</p>
<p>原理: 除以 2 的幂的无符号除法</p>
<p><span class="arithmatex">\(\mathrm{C}\)</span> 变量 <span class="arithmatex">\(\mathrm{x}\)</span> 和 <span class="arithmatex">\(\mathrm{k}\)</span> 有无符号数值 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(k\)</span> ,且 <span class="arithmatex">\(0 \leq  k &lt; w\)</span> ,则 <span class="arithmatex">\(\mathrm{C}\)</span> 表达式 <span class="arithmatex">\(\mathrm{x} &gt;  &gt; \mathrm{k}\)</span> 产生数值 <span class="arithmatex">\(\left\lfloor  {x/{2}^{k}}\right\rfloor\)</span> 。</p>
<p>例如, 图 2-28 给出了在 12340 的 16 位表示上执行逻辑右移的结果, 以及对它执行除以 1、2、16 和 256 的结果。从左端移入的 0 以斜体表示。我们还给出了用真正的运算做除法得到的结果。这些示例说明, 移位总是舍入到零的结果, 这一点与整数除法的规则一样。</p>
<!-- Media -->

<table><tr><td>$\mathrm{k}$</td><td>$>  > \mathrm{k}$ (二进制)</td><td>十进制</td><td>${12340}/{2}^{k}$</td></tr><tr><td>0</td><td>0011000000110100</td><td>12340</td><td>12340.0</td></tr><tr><td>1</td><td>0001100000011010</td><td>6170</td><td>6170.0</td></tr><tr><td>4</td><td>0000001100000011</td><td>771</td><td>771.25</td></tr><tr><td>8</td><td>0000000000110000</td><td>48</td><td>48.203125</td></tr></table>

<p>图 2-28 无符号数除以 2 的幂(这个例子说明了执行一个逻辑右移 <span class="arithmatex">\(k\)</span> 位与除以 <span class="arithmatex">\({2}^{k}\)</span> 再舍入到零有一样的效果)</p>
<!-- Media -->

<p>推导: 除以 2 的幂的无符号除法</p>
<p>设 <span class="arithmatex">\(x\)</span> 为位模式 <span class="arithmatex">\(\left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{0}} \right\rbrack\)</span> 表示的无符号整数,而 <span class="arithmatex">\(k\)</span> 的取值范围为 <span class="arithmatex">\(0 \leq  k &lt;\)</span> <span class="arithmatex">\(w\)</span> 。设 <span class="arithmatex">\({x}^{\prime }\)</span> 为 <span class="arithmatex">\(w - k\)</span> 位位表示 <span class="arithmatex">\(\left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{k}} \right\rbrack\)</span> 的无符号数,而 <span class="arithmatex">\({x}^{\prime \prime }\)</span> 为 <span class="arithmatex">\(k\)</span> 位位表示 <span class="arithmatex">\(\left\lbrack  {x}_{k - 1}\right.\)</span> , <span class="arithmatex">\(\left. {\cdots ,{x}_{0}}\right\rbrack\)</span> 的无符号数。由此,我们可以看到 <span class="arithmatex">\(x = {2}^{k}{x}^{\prime } + {x}^{\prime \prime }\)</span> ,而 <span class="arithmatex">\(0 \leq  {x}^{\prime \prime } &lt; {2}^{k}\)</span> 。因此,可得 <span class="arithmatex">\(\lfloor x/\)</span> <span class="arithmatex">\({2}^{k}\rbrack  = {x}^{\prime }\)</span> 。</p>
<p>对位向量 <span class="arithmatex">\(\left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{0}} \right\rbrack\)</span> 逻辑右移 <span class="arithmatex">\(k\)</span> 位会得到位向量</p>
<div class="arithmatex">\[
\left\lbrack  {0,\cdots ,0,{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{k}}\right\rbrack  
\]</div>
<p>这个位向量有数值 <span class="arithmatex">\({x}^{\prime }\)</span> ,我们看到,该值可以通过计算 <span class="arithmatex">\(\mathrm{x} &gt; \mathrm{k}\)</span> 得到。</p>
<p>对于除以 2 的幂的补码运算来说, 情况要稍微复杂一些。首先, 为了保证负数仍然为负,移位要执行的是算术右移。现在让我们来看看这种右移会产生什么结果。</p>
<p>原理: 除以 2 的幂的补码除法, 向下舍入</p>
<p><span class="arithmatex">\(\mathrm{C}\)</span> 变量 <span class="arithmatex">\(\mathrm{x}\)</span> 和 <span class="arithmatex">\(\mathrm{k}\)</span> 分别有补码值 <span class="arithmatex">\(x\)</span> 和无符号数值 <span class="arithmatex">\(k\)</span> ,且 <span class="arithmatex">\(0 \leq  k &lt; w\)</span> ,则当执行算术移位时, <span class="arithmatex">\(\mathrm{C}\)</span> 表达式 <span class="arithmatex">\(\mathrm{x} &gt; \mathrm{k}\)</span> 产生数值 <span class="arithmatex">\(\left\lfloor  {x/{2}^{k}}\right\rfloor\)</span> 。</p>
<p>对于 <span class="arithmatex">\(x \geq  0\)</span> ,变量 <span class="arithmatex">\(\mathrm{x}\)</span> 的最高有效位为 0,所以效果与逻辑右移是一样的。因此,对于非负数来说,算术右移 <span class="arithmatex">\(k\)</span> 位与除以 <span class="arithmatex">\({2}^{k}\)</span> 是一样的。作为一个负数的例子,图 2-29 给出了对 -12340 的 16 位表示进行算术右移不同位数的结果。对于不需要舍入的情况 <span class="arithmatex">\(\left( {k = 1}\right)\)</span> ,结果是 <span class="arithmatex">\(x/{2}^{k}\)</span> 。但是当需要进行舍入时, 移位导致结果向下舍入。例如, 右移 4 位将会把 -771.25 向下舍入为 -772。我们需要调整策略来处理负数 <span class="arithmatex">\(x\)</span> 的除法。</p>
<!-- Meanless: 第 2 章 信息的表示和处理 73-->

<!-- Media -->

<table><tr><td>$\mathrm{k}$</td><td>$>  > \mathrm{k}$ (二进制)</td><td>十进制</td><td>$- {12340}/{2}^{\mathrm{k}}$</td></tr><tr><td>0</td><td>1100111111001100</td><td>-12340</td><td>-12340.0</td></tr><tr><td>1</td><td>I 110011111100110</td><td>-6170</td><td>-6170.0</td></tr><tr><td>4</td><td>1111110011111100</td><td>-772</td><td>-771.25</td></tr><tr><td>8</td><td>1111111111001111</td><td>-49</td><td>-48.203125</td></tr></table>

<p>图 2-29 进行算术右移 (这个例子说明了算术右移类似于除以 2 的幂,</p>
<p>除了是向下舍入, 而不是向零舍入)</p>
<!-- Media -->

<p>推导: 除以 2 的幂的补码除法, 向下舍入</p>
<p>设 <span class="arithmatex">\(x\)</span> 为位模式 <span class="arithmatex">\(\left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{0}} \right\rbrack\)</span> 表示的补码整数,而 <span class="arithmatex">\(k\)</span> 的取值范围为 <span class="arithmatex">\(0 \leq  k &lt; w\)</span> 。设 <span class="arithmatex">\({x}^{\prime }\)</span> 为 <span class="arithmatex">\(w - k\)</span> 位 <span class="arithmatex">\(\left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{k}} \right\rbrack\)</span> 表示的补码数,而 <span class="arithmatex">\({x}^{\prime \prime }\)</span> 为低 <span class="arithmatex">\(k\)</span> 位 <span class="arithmatex">\(\left\lbrack  {{x}_{k - 1},\cdots ,{x}_{0}} \right\rbrack\)</span> 表示的无符号数。通过与对无符号情况类似的分析,我们有 <span class="arithmatex">\(x = {2}^{k}{x}^{\prime } + {x}^{\prime \prime }\)</span> ,而 <span class="arithmatex">\(0 \leq  {x}^{\prime \prime } &lt; {2}^{k}\)</span> ,得到 <span class="arithmatex">\({x}^{\prime } = \left\lfloor  {x/{2}^{k}}\right\rfloor\)</span> 。进一步,可以观察到,算术右移位向量 <span class="arithmatex">\(\left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{0}} \right\rbrack  k\)</span> 位,得到位向量</p>
<div class="arithmatex">\[
\left\lbrack  {{x}_{w - 1},\cdots ,{x}_{w - 1},{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{k}} \right\rbrack  
\]</div>
<p>它刚好就是将 <span class="arithmatex">\(\left\lbrack  {{x}_{w - 1},{x}_{w - 2},\cdots ,{x}_{k}} \right\rbrack\)</span> 从 <span class="arithmatex">\(w - k\)</span> 位符号扩展到 <span class="arithmatex">\(w\)</span> 位。因此,这个移位后的位向量就是 <span class="arithmatex">\(\left\lfloor  {x/{2}^{k}}\right\rfloor\)</span> 的补码表示。</p>
<p>我们可以通过在移位之前 “偏置 (biasing)” 这个值, 来修正这种不合适的舍入。</p>
<p>原理：除以 2 的幂的补码除法,向上舍入</p>
<p><span class="arithmatex">\(\mathrm{C}\)</span> 变量 <span class="arithmatex">\(\mathrm{x}\)</span> 和 <span class="arithmatex">\(\mathrm{k}\)</span> 分别有补码值 <span class="arithmatex">\(x\)</span> 和无符号数值 <span class="arithmatex">\(k\)</span> ,且 <span class="arithmatex">\(0 \leq  k &lt; w\)</span> ,则当执行算术移位时, <span class="arithmatex">\(\mathrm{C}\)</span> 表达式 <span class="arithmatex">\(\left( {\mathrm{x} + \left( {1 &lt;  &lt; \mathrm{k}}\right)  - 1}\right)  &gt;  &gt; \mathrm{k}\)</span> 产生数值 <span class="arithmatex">\(\left\lfloor  {x/{2}^{k}}\right\rfloor\)</span> 。</p>
<p>图 2-30 说明在执行算术右移之前加上一个适当的偏置量是如何导致结果正确舍入的。在第 3 列,我们给出了 -12340 加上偏量值之后的结果,低 <span class="arithmatex">\(k\)</span> 位 (那些会向右移出的位) 以斜体表示。我们可以看到,低 <span class="arithmatex">\(k\)</span> 位左边的位可能会加 1,也可能不会加 1。对于不需要舍入的情况 <span class="arithmatex">\(\left( {k = 1}\right)\)</span> ,加上偏量只影响那些被移掉的位。对于需要舍入的情况,加上偏量导致较高的位加 1 ,所以结果会向零舍入。</p>
<!-- Media -->

<table><tr><td>$\mathrm{k}$</td><td>偏量</td><td>$- {12340} +$ 偏量</td><td>$>  > \mathrm{k}$ (二进制)</td><td>十进制</td><td>$- {12340}/{2}^{\mathrm{k}}$</td></tr><tr><td>0</td><td>0</td><td>1100111111001100</td><td>1100111111001100</td><td>-12340</td><td>-12340.0</td></tr><tr><td>1</td><td>1</td><td>110011111100110/</td><td>1110011111100110</td><td>-6170</td><td>-6170.0</td></tr><tr><td>4</td><td>15</td><td>1100111111011011</td><td>IIII 1110011111101</td><td>-771</td><td>-771.25</td></tr><tr><td>8</td><td>255</td><td>1101000011001011</td><td>11111111111010000</td><td>-48</td><td>-48.203125</td></tr></table>

<p>图 2-30 补码除以 2 的幂 (右移之前加上一个偏量, 结果就向零舍入了)</p>
<!-- Media -->

<p>偏置技术利用如下属性：对于整数 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\left( {y &gt; 0}\right) ,\left\lbrack  {x/y}\right\rbrack   = \left\lbrack  {\left( {x + y - 1}\right) /y}\right\rbrack\)</span> 。例如,当 <span class="arithmatex">\(x =  - {30}\)</span> 和 <span class="arithmatex">\(y = 4\)</span> ,我们有 <span class="arithmatex">\(x + y - 1 =  - {27}\)</span> ,而 <span class="arithmatex">\(\lceil  - {30}/4\rceil  =  - 7 = \lfloor  - {27}/4\rfloor\)</span> 。当 <span class="arithmatex">\(x =  - {32}\)</span> 和 <span class="arithmatex">\(y = 4\)</span> 时,我们有 <span class="arithmatex">\(x + y - 1 =  - {29}\)</span> ,而 <span class="arithmatex">\(\left\lbrack  {-{32}/4}\right\rbrack   =  - 8 = \left\lbrack  {-{29}/4}\right\rbrack\)</span> 。</p>
<p>推导: 除以 2 的幂的补码除法, 向上舍入</p>
<p>查看 <span class="arithmatex">\(\left\lbrack  {x/y}\right\rbrack   = \lfloor \left( {x + y - 1}\right) /y\rfloor\)</span> ,假设 <span class="arithmatex">\(x = {qy} + r\)</span> ,其中 <span class="arithmatex">\(0 \leq  r &lt; y\)</span> ,得到 <span class="arithmatex">\(\left( {x + y - 1}\right) /y =\)</span> <span class="arithmatex">\(q + \left( {r + y - 1}\right) /y\)</span> ,因此 <span class="arithmatex">\(\left\lbrack  {\left( {x + y - 1}\right) /y}\right\rbrack   = q + \left\lbrack  {\left( {r + y - 1}\right) /y}\right\rbrack\)</span> 。当 <span class="arithmatex">\(r = 0\)</span> 时,后面一项等于 0, 而当 <span class="arithmatex">\(r &gt; 0\)</span> 时,等于 1。也就是说,通过给 <span class="arithmatex">\(x\)</span> 增加一个偏量 <span class="arithmatex">\(y - 1\)</span> ,然后再将除法向下舍入, 当 <span class="arithmatex">\(y\)</span> 整除 <span class="arithmatex">\(x\)</span> 时,我们得到 <span class="arithmatex">\(q\)</span> ,否则,就得到 <span class="arithmatex">\(q + 1\)</span> 。</p>
<!-- Meanless: 74 第一部分 程序结构和执行-->

<p>回到 <span class="arithmatex">\(y = {2}^{k}\)</span> 的情况, <span class="arithmatex">\(\mathrm{C}\)</span> 表达式 <span class="arithmatex">\(\mathrm{x} + \left( {1 &lt;  &lt; \mathrm{k}}\right)  - 1\)</span> 得到数值 <span class="arithmatex">\(x + {2}^{k} - 1\)</span> 。将这个值算术右移 <span class="arithmatex">\(k\)</span> 位即产生 <span class="arithmatex">\(\left\lfloor  {x/{2}^{k}}\right\rfloor\)</span> 。</p>
<p>这个分析表明对于使用算术右移的补码机器, <span class="arithmatex">\(\mathrm{C}\)</span> 表达式</p>
<hr />
<p><span class="arithmatex">\(\left( {x &lt; 0?x + \left( {1 &lt;  &lt; k}\right)  - 1 : x}\right)  &gt;  &gt; k\)</span></p>
<hr />
<p>将会计算数值 <span class="arithmatex">\(x/{2}^{k}\)</span> 。</p>
<details class="question">
<summary>练习题 2.42</summary>
<p>写一个函数 div 16,对于整数参数 <span class="arithmatex">\(\mathrm{x}\)</span> 返回 <span class="arithmatex">\(\mathrm{x}/{16}\)</span> 的值。你的函数不能使用除法、模运算、乘法、任何条件语句 (if 或者?:)、任何比较运算符 (例如&lt;) &gt;或==) 或任何循环。你可以假设数据类型 int 是 32 位长, 使用补码表示, 而右移是算术右移。</p>
<p>现在我们看到, 除以 2 的幂可以通过逻辑或者算术右移来实现。这也正是为什么大多数机器上提供这两种类型的右移。不幸的是, 这种方法不能推广到除以任意常数。同乘法不同,我们不能用除以 2 的幂的除法来表示除以任意常数 <span class="arithmatex">\(K\)</span> 的除法。</p>
</details>
<details class="question">
<summary>练习题 2.43</summary>
<p>在下面的代码中,我们省略了常数 <span class="arithmatex">\(\mathrm{M}\)</span> 和 <span class="arithmatex">\(\mathrm{N}\)</span> 的定义:</p>
<hr />
<h1 id="define-m-mystery-number-1">define M /<em> Mystery number 1 </em>/<a class="headerlink" href="#define-m-mystery-number-1" title="Permanent link">&para;</a></h1>
<h1 id="define-n-mystery-number-2">define N /<em> Mystery number 2 </em>/<a class="headerlink" href="#define-n-mystery-number-2" title="Permanent link">&para;</a></h1>
<p>int arith( int x, int y ) {
    int result = 0 ;
    result <span class="arithmatex">\(= \mathrm{x} * \mathrm{M} + \mathrm{y}/\mathrm{N};/ * \mathrm{M}\)</span> and <span class="arithmatex">\(\mathrm{N}\)</span> are mystery numbers. <span class="arithmatex">\(* /\)</span>
    return result;
}</p>
<hr />
<p>我们以某个 <span class="arithmatex">\(\mathrm{M}\)</span> 和 <span class="arithmatex">\(\mathrm{N}\)</span> 的值编译这段代码。编译器用我们讨论过的方法优化乘法和除法。下面是将产生出的机器代码翻译回 C 语言的结果:</p>
<hr />
<p>/<em> Translation of assembly code for arith <span class="arithmatex">\(*\)</span> /
int optarith(int x, int y) {
    int t = x ;
    x <span class="arithmatex">\(&lt;  &lt;  = 5\)</span> ;
    <span class="arithmatex">\(\mathrm{x} = \mathrm{t}\)</span> ;
    if (y &lt; 0) y += 7;
    y &gt;&gt;= 3; /</em> Arithmetic shift */
    return x+y;
}</p>
<hr />
<p><span class="arithmatex">\(\mathrm{M}\)</span> 和 <span class="arithmatex">\(\mathrm{N}\)</span> 的值为多少?</p>
</details>
<h2 id="238">2.3.8 关于整数运算的最后思考<a class="headerlink" href="#238" title="Permanent link">&para;</a></h2>
<p>正如我们看到的, 计算机执行的 “整数” 运算实际上是一种模运算形式。表示数字的有限字长限制了可能的值的取值范围, 结果运算可能溢出。我们还看到, 补码表示提供了一种既能表示负数也能表示正数的灵活方法, 同时使用了与执行无符号算术相同的位级实现, 这些运算包括像加法、减法、乘法, 甚至除法, 无论运算数是以无符号形式还是以补码形式表示的, 都有完全一样或者非常类似的位级行为。</p>
<p>我们看到了 <span class="arithmatex">\(\mathrm{C}\)</span> 语言中的某些规定可能会产生令人意想不到的结果,而这些结果可能是难以察觉或理解的缺陷的源头。我们特别看到了 unsigned 数据类型, 虽然它概念上很简单, 但可能导致即使是资深程序员都意想不到的行为。我们还看到这种数据类型会以出乎意料的方式出现,比如,当书写整数常数和当调用库函数时。</p>
<!-- Meanless: 第 2 章 信息的表示和处理 75-->

<details class="question">
<summary>练习题 2.44</summary>
<p>假设我们在对有符号值使用补码运算的 32 位机器上运行代码。对于有符号值使用的是算术右移, 而对于无符号值使用的是逻辑右移。变量的声明和初始化如下:</p>
<hr />
<div class="language-text highlight"><pre><span></span><code>int x = foo(   ); /* Arbitrary value */
int $y = \operatorname{bar}\left( \right) ;\;$ /* Arbitrary value */
</code></pre></div>
<p>unsigned ux = x ;
unsigned uy = y ;</p>
<hr />
<p>对于下面每个 <span class="arithmatex">\(\mathrm{C}\)</span> 表达式,1) 证明对于所有的 <span class="arithmatex">\(\mathrm{x}\)</span> 和 <span class="arithmatex">\(\mathrm{y}\)</span> 值,它都为真 (等于 1); 或者 2) 给出使得它为假 (等于 0 ) 的 <span class="arithmatex">\(\mathrm{x}\)</span> 和 <span class="arithmatex">\(\mathrm{y}\)</span> 的值:</p>
<p>A. <span class="arithmatex">\(\left( {x &gt; 0}\right)  \mid   \mid  \left( {x - 1 &lt; 0}\right)\)</span></p>
<p>B. <span class="arithmatex">\(\left( {x\&amp; 7}\right) ! = 7 \mid   \mid  \left( {x &lt; {29} &lt; 0}\right)\)</span></p>
<p>C. <span class="arithmatex">\(\left( {\mathrm{x} * \mathrm{x}}\right)  &gt;  = 0\)</span></p>
<p>D. <span class="arithmatex">\(x &lt; 0\left| \right|  - x &lt;  = 0\)</span></p>
<p>E. <span class="arithmatex">\(x &gt; 0\left| \right|  - x &gt;  = 0\)</span></p>
<p>F. <span class="arithmatex">\(x + y =  = {uy} + {ux}\)</span></p>
<p>G. x<em>~y + uy</em>ux == -x</p>
</details>







  
  






  <h2 id="__comments">Comments</h2>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js"
        data-repo="syiooo/syiooo.github.io"
        data-repo-id="R_kgDOPeemcg"
        data-category="Show and tell"
        data-category-id="DIC_kwDOPeemcs4CuRNW"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["attr_list", "md_in_html", "pymdownx.superfences", "content.tooltips", "navigation.instant.progress", "navigation.tracking", "navigation.prune", "navigation.indexes", "toc.follow", "navigation.top", "content.code.copy", "content.code.select", "navigation.tabs"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>